# 将你的肉鸽理解灌注给牛牛--集成战略协议

## 1.肉鸽资源存放位置

 - `resource/roguelike/`下按照主题存放各个肉鸽的作业资源
   - 主题文件夹：`Phantom/` 为傀影肉鸽资源，`Mizuki/` 为水月肉鸽资源,`Sami/` 为萨米肉鸽资源
     - `autopilot/`内是各个关卡的作战json
       - `关卡名.json` 关卡的作战逻辑
     - `encounter.json` 不期而遇类事件逻辑
     - `recruitment.json` 干员招募逻辑
     - `shopping.json` 商店购买藏品逻辑

## 2.肉鸽第一步--干员招募

`resource/roguelike/theme name/recruitment.json` 描述了干员招募的逻辑

```jsonc

```


### 1. 干员分类

按照你的游戏理解将干员分成不同的 ***groups*** （群组，相关概念参考 3-3 战斗流程协议）
    
#### a. 已有群组介绍

以傀影肉鸽的作业为例：主要将干员分为了 
| 分组  | 主要考量 | 主要包括职业 | 举例干员 |  
| :--- | :--- | :--- | :--- |
| ***地面阻挡***  | 站场和清杂  | 重装、近卫 | 奶盾、基石、羽毛笔、山、M3、令和稀音的召唤物、斑点、重装预备干员 |
| ***地面单切***  | 单独对战精英怪  | 处决者特种 | 史尔特尔、异德、夜刀x、M3、红 |
| ***高台C***  | 常态和决战输出  | 狙击、术士 | 假日威龙陈、澄闪、艾雅法拉、肥鸭 |
| ***高台输出***  | 对空和常态输出  | 狙击、术士 | 空弦、能天使、克洛丝、史都华德 |
| ***奶***  | 站场和清杂能力  | 治疗、辅助 | 凯尔希、浊心斯卡蒂、芙蓉、安赛尔 |
| ***回费***  | 回复cost  | 先锋 | 桃金娘、伊内丝、芬、香草 |
| ***炮灰***  | 吸收炮弹、再部署  | 特种、召唤物 | M3、红、桃金娘、预备干员 |
| ***高台预备***  | 有一定输出能力  |  | 梓兰、预备干员 |

#### b. 需要特殊操作的群组

除了上面那些比较笼统的分组，我们有时候需要对一些干员或者干员种类进行一些定制的精细化操作，比如
| 分组  | 包括干员 | 主要特点 |
| :--- | :--- | :--- |
| 棘刺  | 棘刺、号角 | 地面远程输出，有些图有非常适配的位置 |
| 凯尔希  | 棘刺、号角 | 自带地面阻挡，有的图需要优先部署，毒雾图部署优先度比正常奶低 |
| 情报官  | 晓哥、伊内丝 | 既可以回费、又可以阻挡、还可以单切 |
| 浊心斯卡蒂  | 浊心斯卡蒂 | 低压时奶量尚可，但是范围特殊，一些图有比较适配的位置 |
| 银灰  | 银灰、玛恩纳 | 地面决战输出，可以针对boss进行部署 |
| 史尔特尔  | 史尔特尔 | 由于精二后固定携带3技能，这时站场能力几乎为零，需要阻挡位的部署优先度极低 |

#### c. 需要注意的地方

**目前固定将未识别到的地面干员归入倒数第二个编组后面，未识别到的高台干员归入倒数第一个编组后面**
```jsonc
"Mizuki": {                 // 集成战略主题名称，后接若干字段
    "groups": [             // 对所有干员进行分组，实际作战时会按照干员分组进行顺序部署，非常重要！
        "百嘉",
        "基石",
        "召唤",
        "玛恩纳",
        "号角",
        "异德",
        "高台C",
        "地面C",
        "地刺",
        "控制",
        "单奶",
        "群奶",
        "投锋",
        "挡人先锋",
        "刺客",
        "重装",
        "术师",
        "狙击",
        "辅助",
        "骰子",
        "障碍物",
        "其他地面",
        "其他高台"
    ],
    "team_complete_condition": [  // 阵容完备判断条件，仅当所有groups干员不少于对应threshold时，阵容完备
                                  // 在阵容未完备时，仅招募核心干员(key干员)与0希望干员
        {
            "groups": [ "百嘉", "号角", "玛恩纳", "地面C" ],
            "threshold": 2
        },
        {
            "groups": [ "高台C" ],
            "threshold": 1
        },
        {
            "groups": [ "控制" ],
            "threshold": 1
        },
        {
            "groups": [ "群奶", "单奶" ],
            "threshold": 1
        },
        {
            "groups": [ "刺客", "重装" ],
            "threshold": 1
        },
        {
            "groups": [ "挡人先锋", "投锋" ],
            "threshold": 1
        }
    ],
    "百嘉": {
        "opers": [
            {
                "name": "百炼嘉维尔",
                "skill": 2,                    // 使用技能
                "recruit_priority": 900,       // 招募优先级
                "promote_priority": 600,       // 进阶优先级
                "is_key": true,                // 在阵容未完备时，仅招募key干员与0希望干员
                "is_start": true,              // 在队伍中没有start干员时，仅招募start干员与0希望干员
                "recruit_priority_offsets": [  // 按当前阵容调控招募优先级
                    {
                        "groups": [ "基石", "召唤", "号角", "地面C" ],
                        "threshold": 1,
                        "is_less": true,
                        "offset": 100,
                        "Doc": "地面阻挡输出位≤1时，百炼嘉维尔的招募优先级+100"
                    },
                    {
                        "groups": [ "基石", "召唤", "号角", "地面C" ],
                        "threshold": 3,
                        "offset": -600,
                        "Doc": "地面阻挡输出位≥3时，百炼嘉维尔的招募优先级-600"
                    }
                ]
            }
        ]
    },
    ...
```
## 战斗部署

`resource/copilot.json` 描述了每个关卡信息和作战策略

```jsonc
[
    {
        "stage_name": "蓄水池",  // 关卡名
        "replacement_home": [    // 重要防守点，至少需要填写1个
            {
                "location": [
                    6,
                    4
                ],
                "direction_Doc1": "优先朝向，但并不代表绝对是这个方向（算法自行判断）",
                "direction_Doc2": "不填默认 none，即没有推荐方向，完全由算法自行判断",
                "direction_Doc3": "none / left / right / up / down / 无 / 上 / 下 / 左 / 右",
                "direction": "left"
            }
        ],
        "blacklist_location_Doc": "这里是用法举例，不是说蓄水池这个图需要 ban 这两个点",
        "blacklist_location": [  // 禁止程序进行部署的位置
            [
                0,
                0
            ],
            [
                1,
                1
            ]
        ],
        "not_use_dice_Doc": "蓝门干员撤退时是否需要用骰子，不写默认false",
        "not_use_dice": false,
        "role_order_Doc": "干员类型部署顺序，未写出部分以近卫，先锋，医疗，重装，狙击，术士，辅助，特种，召唤物的顺序补全，输入英文",
        "role_order": [ // 不推荐使用，请配置deploy_plan字段
            "warrior",
            "pioneer",
            "medic",
            "tank",
            "sniper",
            "caster",
            "support",
            "special",
            "drone"
        ],
        "force_air_defense_when_deploy_blocking_num_Doc": "场上有10000个阻挡单位时就开始强制部署总共1个对空单位（填不填写均不影响正常部署逻辑），在此期间不禁止部署医疗单位（不写默认false）",
        "force_air_defense_when_deploy_blocking_num": { // 不推荐使用，请配置deploy_plan字段
            "melee_num": 10000,
            "air_defense_num": 1,
            "ban_medic": false
        },
        "force_deploy_direction_Doc": "这些点对某些职业强制部署方向",
        "force_deploy_direction": [ // 不推荐使用，请配置deploy_plan字段
            {
                "location": [
                    1,
                    1
                ],
                "role_Doc": "填入的职业适用强制方向",
                "role": [
                    "warrior",
                    "pioneer"
                ],
                "direction": "up"
            },
            {
                "location": [
                    3,
                    1
                ],
                "role": [
                    "sniper"
                ],
                "direction": "left"
            }
        ],
        "deploy_plan": [ // 部署逻辑，按从上到下、从左到右的顺序进行检索，并尝试完成第一个合法操作
            {
                "groups": [ "百嘉", "基石", "地面C", "号角", "挡人先锋", "重装", "其他地面", "异德", "刺客" ],
                "location": [ 6, 4 ],
                "direction": "left"
            },
            {
                "groups": [ "召唤" ],
                "location": [ 6, 3 ],
                "direction": "left"
            },
            {
                "groups": [ "百嘉", "基石", "地面C", "号角", "玛恩纳", "地刺", "重装", "投锋", "挡人先锋", "其他地面" ],
                "location": [ 7, 4 ],
                "direction": "left"
            },
            {
                "groups": [ "单奶", "群奶" ],
                "location": [ 6, 2 ],
                "direction": "down"
            },
            {
                "groups": [ "高台C", "控制", "术师", "狙击", "辅助" ],
                "location": [ 6, 3 ],
                "direction": "left"
            },
            {
                "groups": [ "召唤", "高台C", "控制", "术师", "狙击", "辅助", "其他高台" ],
                "location": [ 6, 2 ],
                "direction": "up"
            },
            {
                "groups": [ "地面C", "异德", "地刺", "刺客", "挡人先锋", "其他地面" ],
                "location": [ 6, 1 ],
                "direction": "right"
            },
            {
                "groups": [ "召唤", "高台C", "控制", "术师", "狙击", "辅助", "其他高台" ],
                "location": [ 2, 3 ],
                "direction": "right"
            }
        ]
    },
    {
        "stage_name": "饥渴",
        "replacement_home": [
            {
                "location": [
                    3,
                    3
                ],
                "direction": "down"
            }
        ],
        "deploy_plan": [
            {
                "groups": [ "异德", "刺客", "挡人先锋", "其他地面" ],
                "location": [ 5, 3 ],
                "direction": "left",
                "condition": [ 0, 3 ]       // 该操作仅在击杀数为0-3时进行
            },
            {
                "groups": [ "异德", "刺客", "挡人先锋", "其他地面" ],
                "location": [ 5, 3 ],
                "direction": "left",
                "condition": [ 6, 10 ]
            },
            {
                "groups": [ "异德", "刺客", "挡人先锋", "其他地面" ],
                "location": [ 5, 3 ],
                "direction": "left",
                "condition": [ 15, 20 ]
            },
            {
                "groups": [ "百嘉", "基石", "地面C", "号角", "挡人先锋", "重装", "其他地面", "异德", "刺客" ],
                "location": [ 3, 3 ],
                "direction": "down"
            },
            {
                "groups": [ "高台C", "召唤", "控制", "术师", "狙击", "辅助" ],
                "location": [ 2, 4 ],
                "direction": "down"
            },
            {
                "groups": [ "单奶", "群奶", "高台C", "召唤", "控制", "术师", "狙击", "辅助" ],
                "location": [ 2, 3 ],
                "direction": "right"
            },
            {
                "groups": [ "重装", "百嘉", "基石", "地面C", "玛恩纳", "号角", "地刺", "刺客", "挡人先锋" ],
                "location": [ 4, 3 ],
                "direction": "right"
            },
            {
                "groups": [ "高台C", "召唤", "控制", "术师", "狙击", "辅助" ],
                "location": [ 3, 6 ],
                "direction": "left"
            },
            {
                "groups": [ "地面C", "玛恩纳", "号角", "异德", "地刺", "刺客", "挡人先锋", "其他地面" ],
                "location": [ 3, 2 ],
                "direction": "down"
            }
        ],
        "retreat_plan": [  // 在特定时间点撤退目标
            {
                "location": [ 4, 1 ],
                "condition": [ 7, 8 ] // 在击杀数为7-8时，撤去位置[4,1]的干员
            }
        ]
    },
    ...
]
```
